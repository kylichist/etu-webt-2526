<!-- Управление друзьями -->
<div class="container mt-4">
  <!-- Заголовок -->
  <div class="row mb-4">
    <div class="col">
      <h2>Мои друзья</h2>
    </div>
  </div>

  <!-- Статус загрузки -->
  <div *ngIf="loading()" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Загрузка...</span>
    </div>
  </div>

  <!-- Сообщения -->
  <div *ngIf="success()" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle"></i> {{ success() }}
    <button type="button" class="btn-close" (click)="success.set('')"></button>
  </div>
  <div *ngIf="error()" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle"></i> {{ error() }}
    <button type="button" class="btn-close" (click)="error.set('')"></button>
  </div>

  <div *ngIf="!loading()">
    <!-- Список текущих друзей -->
    <div class="row mb-5">
      <div class="col">
        <h4 class="mb-3">
          Текущие друзья 
          <span class="badge bg-primary">{{ friends().length }}</span>
        </h4>

        <!-- Нет друзей -->
        <div *ngIf="friends().length === 0" class="text-center py-5">
          <i class="bi bi-people" style="font-size: 3rem; color: #ccc;"></i>
          <p class="mt-3 text-muted">У вас пока нет друзей</p>
          <p class="text-muted">Добавьте пользователей из списка ниже</p>
        </div>

        <!-- Карточки друзей -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          <div *ngFor="let friend of friends()" class="col">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <img 
                    [src]="getPhotoUrl(friend.photo)" 
                    alt="Фото профиля"
                    class="rounded-circle me-3"
                    style="width: 60px; height: 60px; object-fit: cover;">
                  <div class="flex-grow-1">
                    <h6 class="mb-1">{{ friend.firstName }} {{ friend.lastName }}</h6>
                    <small class="text-muted">{{ friend.email }}</small>
                  </div>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <span class="badge"
                          [class.bg-success]="friend.status === 'active'"
                          [class.bg-warning]="friend.status === 'unverified'"
                          [class.bg-danger]="friend.status === 'blocked'">
                      {{ friend.status === 'active' ? 'Активен' : 
                         friend.status === 'unverified' ? 'Не подтвержден' : 'Заблокирован' }}
                    </span>
                  </small>
                  <button 
                    class="btn btn-sm btn-outline-danger"
                    (click)="removeFriend(friend.id)"
                    title="Удалить из друзей">
                    <i class="bi bi-person-dash"></i> Удалить
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Разделитель -->
    <hr class="my-5">

    <!-- Список пользователей для добавления -->
    <div class="row">
      <div class="col">
        <h4 class="mb-3">
          Добавить в друзья
          <span class="badge bg-secondary">{{ getNonFriends().length }}</span>
        </h4>

        <!-- Все уже друзья -->
        <div *ngIf="getNonFriends().length === 0" class="text-center py-5">
          <i class="bi bi-people-fill" style="font-size: 3rem; color: #28a745;"></i>
          <p class="mt-3 text-muted">Все пользователи уже в вашем списке друзей!</p>
        </div>

        <!-- Карточки пользователей -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          <div *ngFor="let user of getNonFriends()" class="col">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <img 
                    [src]="getPhotoUrl(user.photo)" 
                    alt="Фото профиля"
                    class="rounded-circle me-3"
                    style="width: 60px; height: 60px; object-fit: cover;">
                  <div class="flex-grow-1">
                    <h6 class="mb-1">{{ user.firstName }} {{ user.lastName }}</h6>
                    <small class="text-muted">{{ user.email }}</small>
                  </div>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <span class="badge"
                          [class.bg-success]="user.status === 'active'"
                          [class.bg-warning]="user.status === 'unverified'"
                          [class.bg-danger]="user.status === 'blocked'">
                      {{ user.status === 'active' ? 'Активен' : 
                         user.status === 'unverified' ? 'Не подтвержден' : 'Заблокирован' }}
                    </span>
                  </small>
                  <button 
                    class="btn btn-sm btn-outline-primary"
                    (click)="addFriend(user.id)"
                    title="Добавить в друзья">
                    <i class="bi bi-person-plus"></i> Добавить
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Навигация -->
    <div class="mt-5 pt-3 border-top">
      <div class="d-flex gap-2">
        <a routerLink="/feed" class="btn btn-outline-secondary">
          <i class="bi bi-house"></i> Лента
        </a>
        <a routerLink="/profile" class="btn btn-outline-secondary">
          <i class="bi bi-person"></i> Профиль
        </a>
      </div>
    </div>
  </div>
</div>
