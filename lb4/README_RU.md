# lb4 - Пользовательское приложение социальной сети

Полноценное пользовательское Angular приложение социальной сети с real-time обновлениями через WebSocket.

## Архитектура

### Backend (Node.js + Express + Socket.IO)
- **Порт:** 3001
- **API:** REST API для работы с пользователями, постами, файлами
- **WebSocket:** Real-time обновления для новых постов
- **Прокси:** Проксирует запросы к lb3 (админ-панель)

### Frontend (Angular 17+)
- **Порт:** 4200 (dev), встроен в backend (production)
- **Компоненты:** 5 основных страниц
- **Стили:** Bootstrap 5 + Bootstrap Icons
- **Реактивность:** Angular Signals

## Установка и запуск

### Разработка

1. **Установить зависимости:**
```bash
npm install
```

2. **Запустить оба сервера одновременно:**
```bash
npm run dev
```

Или запустить отдельно:

```bash
# Backend сервер (порт 3001)
npm run server:dev

# Angular dev server (порт 4200)
npm start
```

3. **Открыть в браузере:**
- Angular приложение: http://localhost:4200
- Backend API: http://localhost:3001

**Важно:** Убедитесь, что lb3 запущен на порту 3000!

### Production (Docker)

Из корня репозитория:

```bash
# Собрать и запустить оба контейнера
docker-compose up --build

# Или в фоновом режиме
docker-compose up -d --build
```

Приложения будут доступны:
- lb3 (админ): http://localhost:3000
- lb4 (пользовательское): http://localhost:3001

## Структура проекта

```
lb4/
├── server/                 # Backend сервер
│   ├── index.js           # Главный файл сервера
│   ├── routes/            # API routes
│   │   ├── api.js         # REST API endpoints
│   │   └── upload.js      # Загрузка файлов
│   └── services/          # Сервисы
│       └── lb3Api.js      # Клиент для lb3 API
├── src/                   # Angular приложение
│   ├── app/
│   │   ├── components/    # Компоненты страниц
│   │   │   ├── register/  # Регистрация
│   │   │   ├── feed/      # Лента новостей
│   │   │   ├── post-form/ # Создание поста
│   │   │   ├── profile/   # Профиль
│   │   │   └── friends/   # Друзья
│   │   ├── services/      # Angular сервисы
│   │   │   ├── api.service.ts        # HTTP API
│   │   │   ├── auth.service.ts       # Авторизация
│   │   │   └── websocket.service.ts  # WebSocket
│   │   └── directives/    # Директивы
│   ├── assets/
│   │   └── sounds/        # Звуковые уведомления
│   └── styles.scss        # Глобальные стили
├── tests/                 # Тесты
│   └── server.test.js     # Jest тесты backend
├── Dockerfile             # Docker образ
└── package.json           # Зависимости и скрипты
```

## Функциональность

### Страницы

1. **Регистрация** (`/register`)
   - Форма регистрации нового пользователя
   - Валидация всех полей
   - Автоматический вход после регистрации

2. **Лента новостей** (`/feed`)
   - Просмотр постов пользователя и его друзей
   - Real-time обновления через WebSocket
   - Звуковое уведомление для новых постов
   - Кнопка перехода в админку (для админов)

3. **Создание поста** (`/post/new`)
   - Форма создания нового поста
   - Счетчик символов (макс 5000)
   - Все друзья получат пост в real-time

4. **Профиль** (`/profile`)
   - Просмотр и редактирование данных профиля
   - Загрузка/удаление фото профиля
   - Валидация при редактировании

5. **Друзья** (`/friends`)
   - Список текущих друзей
   - Добавление новых друзей
   - Удаление из друзей

### Технические особенности

#### WebSocket Real-time обновления
- Автоматическое подключение при загрузке ленты
- Push уведомления о новых постах
- Отображение статуса подключения

#### Angular Signals
Использованы Angular Signals для реактивности:
```typescript
// В AuthService
currentUser = computed(() => this.currentUserSignal());
isAuthenticated = computed(() => this.currentUserSignal() !== null);
isAdmin = computed(() => this.currentUserSignal()?.role === 'admin');
```

#### Валидация форм
- Email: корректный формат
- Имя/Фамилия: только буквы, минимум 2 символа
- Дата рождения: YYYY-MM-DD, год 1900-текущий
- Все поля обязательны для регистрации

#### Загрузка файлов
- Поддержка JPEG, PNG, GIF, WebP
- Максимальный размер: 5MB
- Автоматическая генерация уникальных имен

## API Endpoints

### Пользователи
- `GET /api/users` - Все пользователи
- `GET /api/users/:id` - Пользователь по ID
- `POST /api/users` - Создать пользователя
- `PUT /api/users/:id` - Обновить пользователя
- `DELETE /api/users/:id` - Удалить пользователя
- `GET /api/users/:id/friends` - Друзья пользователя
- `GET /api/users/:id/news` - Лента новостей пользователя

### Посты
- `GET /api/posts` - Все посты (query: ?author=userId)
- `POST /api/posts` - Создать пост (+ WebSocket уведомление)
- `DELETE /api/posts/:id` - Удалить пост (+ WebSocket уведомление)

### Загрузка файлов
- `POST /api/upload/photo` - Загрузить фото
- `DELETE /api/upload/photo/:filename` - Удалить фото

### WebSocket события
- `newPost` - Новый пост создан
- `deletePost` - Пост удален

## Тестирование

```bash
# Запустить Jest тесты backend
npm run test:server
```

## Переменные окружения

- `PORT` - Порт backend сервера (по умолчанию: 3001)
- `HOST` - Хост (по умолчанию: 0.0.0.0)
- `LB3_API_URL` - URL lb3 API (по умолчанию: http://localhost:3000)

## Особенности для учебного проекта

1. **Простота кода**: Код написан максимально понятно с комментариями на русском
2. **CSP отключен**: Content Security Policy отключен для упрощения разработки
3. **Без базы данных**: Данные хранятся в JSON файлах через lb3
4. **Локальный storage**: Авторизация через localStorage (не для production)

## Дополнительные возможности

### Bootstrap компоненты
- Cards для постов и профилей
- Forms с валидацией
- Buttons и Button groups
- Alerts для сообщений
- Badges для статусов

### Bootstrap Icons
- Иконки для навигации
- Иконки для действий (like, comment, share)
- Статусные иконки

### Директивы
- `appHighlight` - Подсветка элементов при наведении

## Известные ограничения

1. Звуковой файл уведомления - placeholder (нужно добавить реальный MP3)
2. Нет проверки прав доступа (любой может редактировать любого пользователя)
3. WebSocket не переподключается автоматически при разрыве
4. Загруженные файлы не удаляются при удалении пользователя

## Roadmap / Будущие улучшения

- [ ] Добавить Angular Material компоненты
- [ ] Реализовать SignalStore для state management
- [ ] Добавить E2E тесты с Playwright
- [ ] Реализовать пагинацию для ленты
- [ ] Добавить поиск пользователей и постов
- [ ] Реализовать комментарии к постам
- [ ] Добавить лайки для постов
- [ ] Улучшить обработку ошибок сети

## Лицензия

Учебный проект. Использование в образовательных целях.
